import java.net.*;import java.io.*;import java.util.*;/*Classe du serveur qui va recevoir les demandes de connection*/public class PokerServer {	static Vector clientList= new Vector();		static PrintWriter screenOut = new PrintWriter(System.out, true);	static ServerSocket serverSocket = null;		public static void main(String[] args) throws IOException {				boolean listening = true;		CommandReader tempCommand;		Thread tempThread;		PokerClientThread tempClient;		int currentNode;		Integer tempPort;		screenOut.println("");screenOut.println("");		screenOut.println("POKER Server v0.1");		screenOut.println("------------------------------------------------------");		screenOut.println(" Notes:");		screenOut.println("Tapez 'HELP' pour voir les commandes");		screenOut.println("------------------------------------------------------");		screenOut.println("");		// on prend le port en argument ou 10000 par dÃ©fault				if  (args.length >= 1){			 tempPort = new Integer(args[0]);										}					else								{								tempPort = 10000;								}						try{				serverSocket = new ServerSocket(tempPort.intValue());			}catch(IOException e){				System.err.println("Erreur de port "+tempPort);				System.exit(-1);			}																				screenOut.println("Le serveur ecoute le port "+tempPort+"\n");				screenOut.print(">");				screenOut.flush();				tempCommand = new CommandReader();				tempCommand.start();							while (listening){				try{													tempClient = new PokerClientThread(serverSocket.accept());					clientList.add(tempClient);					tempThread = new Thread(tempClient);					tempThread.start();						screenOut.println("Nouveau client");				}				catch (IOException e){				}			}			serverSocket.close();			}			static void listClients(){		int i;		PokerClientThread foo;		for (i=0;i<clientList.size();++i){			foo = (PokerClientThread)clientList.get(i);			screenOut.println(" Client "+(i+1)+": "+foo.clientIP);		} 		}			static void deleteClient(PokerClientThread deadClient){		int num;		num=clientList.indexOf(deadClient);		if(num!=-1){		clientList.remove(num);			}  }}/*Classe du lecteur de commandes*/class CommandReader extends Thread{	BufferedReader in = new BufferedReader(new InputStreamReader(System.in));	PrintWriter screenOut = new PrintWriter(System.out, true);	String command;		public CommandReader(){		super("CommandReader");	}	public void run(){		boolean valid;		try{			while ((command = in.readLine()) != null){				valid = false;				command = command.trim().toUpperCase();				if (command.compareTo("QUIT")==0){					valid = true;					PokerServer.serverSocket.close();					System.exit(0);				}				if (command.compareTo("LIST")==0){					valid = true;					screenOut.println("");					PokerServer.listClients();					screenOut.println("");				}				if (command.compareTo("HELP")==0){					valid = true;					screenOut.println("\n LIST - liste des clients connectes");					screenOut.println(" QUIT - deconnecte les clients et quitte le serveur \n");				}				if (!valid){					screenOut.println("\nError: tapez 'HELP' pour voir les commandes supportÃ©es\n");				}				screenOut.print(">");				screenOut.flush();			}		}		catch (IOException e){			e.printStackTrace();		}			}};////  CLASSE THREAD  (chaque client a un thread)---------------------------------------------//-------------------------------------------------------------class PokerClientThread extends Thread {	PrintWriter screenOut = new PrintWriter(System.out, true);	private Socket socket = null;	public String clientIP;	public PrintWriter out;	public BufferedReader in;	public int partieClient;	public String pseudo = "";	public PokerClientThread(Socket socket){		super("PokerClientThread");		this.socket = socket;	}		public void run(){		clientIP = socket.getInetAddress().getHostAddress();				try{			out = new PrintWriter(socket.getOutputStream(), true);			in = new BufferedReader (new InputStreamReader(socket.getInputStream()));			String inputLine;			int streamResult;			char buf[] = new char[1];			do{						inputLine = "";				do{									streamResult = in.read(buf, 0, 1);					inputLine += buf[0];				} while (buf[0] != '\u0000');																																	if(inputLine.length()!=1){				/*				C'est ici qu'on va traiter les messages reçus				*/																	//Reception nom des clients			if(inputLine.length()>=5 && inputLine.substring(0,5).equals("<nom>")){							this.pseudo = inputLine.substring(5);								}																																	 }											} while (streamResult != -1);													PokerServer.deleteClient(this);			in.close();			out.close();			socket.close();		}catch(IOException e){		screenOut.println("ya un bug dans un thread ");		e.printStackTrace();		}					}		public void send(String message){		out.println(message);			}}